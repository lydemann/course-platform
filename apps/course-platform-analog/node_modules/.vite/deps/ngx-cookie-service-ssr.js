import {
  DOCUMENT,
  isPlatformBrowser
} from "./chunk-GAVWN3A4.js";
import {
  Inject,
  Injectable,
  InjectionToken,
  Optional,
  PLATFORM_ID,
  setClassMetadata,
  ɵɵdefineInjectable,
  ɵɵinject
} from "./chunk-F5W7JMMH.js";
import "./chunk-6AXJVIE6.js";
import "./chunk-K7BLW2FG.js";
import "./chunk-OIFAVY64.js";
import "./chunk-6QIBDZUR.js";
import "./chunk-WGAPYIUP.js";

// node_modules/.pnpm/ngx-cookie-service-ssr@17.1.0_@angular+common@18.0.1_@angular+core@18.0.1_rxjs@7.8.1_zone.js@_q563444bi5z347hscidnzrqajy/node_modules/ngx-cookie-service-ssr/fesm2022/ngx-cookie-service-ssr.mjs
var REQUEST = new InjectionToken("REQUEST");
var _SsrCookieService = class _SsrCookieService {
  constructor(document, platformId, request) {
    this.document = document;
    this.platformId = platformId;
    this.request = request;
    this.documentIsAccessible = isPlatformBrowser(this.platformId);
  }
  /**
   * Get cookie Regular Expression
   *
   * @param name Cookie name
   * @returns property RegExp
   *
   * @author: Stepan Suvorov
   * @since: 1.0.0
   */
  static getCookieRegExp(name) {
    const escapedName = name.replace(/([\[\]\{\}\(\)\|\=\;\+\?\,\.\*\^\$])/gi, "\\$1");
    return new RegExp("(?:^" + escapedName + "|;\\s*" + escapedName + ")=(.*?)(?:;|$)", "g");
  }
  /**
   * Gets the unencoded version of an encoded component of a Uniform Resource Identifier (URI).
   *
   * @param encodedURIComponent A value representing an encoded URI component.
   *
   * @returns The unencoded version of an encoded component of a Uniform Resource Identifier (URI).
   *
   * @author: Stepan Suvorov
   * @since: 1.0.0
   */
  static safeDecodeURIComponent(encodedURIComponent) {
    try {
      return decodeURIComponent(encodedURIComponent);
    } catch {
      return encodedURIComponent;
    }
  }
  /**
   * Return `true` if {@link Document} is accessible, otherwise return `false`
   *
   * @param name Cookie name
   * @returns boolean - whether cookie with specified name exists
   *
   * @author: Stepan Suvorov
   * @since: 1.0.0
   */
  check(name) {
    var _a;
    name = encodeURIComponent(name);
    const regExp = _SsrCookieService.getCookieRegExp(name);
    return regExp.test(this.documentIsAccessible ? this.document.cookie : (_a = this.request) == null ? void 0 : _a.headers.cookie);
  }
  /**
   * Get cookies by name
   *
   * @param name Cookie name
   * @returns property value
   *
   * @author: Stepan Suvorov
   * @since: 1.0.0
   */
  get(name) {
    var _a;
    if (this.check(name)) {
      name = encodeURIComponent(name);
      const regExp = _SsrCookieService.getCookieRegExp(name);
      const result = regExp.exec(this.documentIsAccessible ? this.document.cookie : (_a = this.request) == null ? void 0 : _a.headers.cookie);
      return result[1] ? _SsrCookieService.safeDecodeURIComponent(result[1]) : "";
    } else {
      return "";
    }
  }
  /**
   * Get all cookies in JSON format
   *
   * @returns all the cookies in json
   *
   * @author: Stepan Suvorov
   * @since: 1.0.0
   */
  getAll() {
    var _a, _b;
    const cookies = {};
    const cookieString = this.documentIsAccessible ? (_a = this.document) == null ? void 0 : _a.cookie : (_b = this.request) == null ? void 0 : _b.headers.cookie;
    if (cookieString && cookieString !== "") {
      cookieString.split(";").forEach((currentCookie) => {
        const [cookieName, cookieValue] = currentCookie.split("=");
        cookies[_SsrCookieService.safeDecodeURIComponent(cookieName.replace(/^ /, ""))] = _SsrCookieService.safeDecodeURIComponent(cookieValue);
      });
    }
    return cookies;
  }
  set(name, value, expiresOrOptions, path, domain, secure, sameSite, partitioned) {
    if (!this.documentIsAccessible) {
      return;
    }
    if (typeof expiresOrOptions === "number" || expiresOrOptions instanceof Date || path || domain || secure || sameSite) {
      const optionsBody = {
        expires: expiresOrOptions,
        path,
        domain,
        secure,
        sameSite: sameSite ? sameSite : "Lax",
        partitioned
      };
      this.set(name, value, optionsBody);
      return;
    }
    let cookieString = encodeURIComponent(name) + "=" + encodeURIComponent(value) + ";";
    const options = expiresOrOptions ? expiresOrOptions : {};
    if (options.expires) {
      if (typeof options.expires === "number") {
        const dateExpires = new Date((/* @__PURE__ */ new Date()).getTime() + options.expires * 1e3 * 60 * 60 * 24);
        cookieString += "expires=" + dateExpires.toUTCString() + ";";
      } else {
        cookieString += "expires=" + options.expires.toUTCString() + ";";
      }
    }
    if (options.path) {
      cookieString += "path=" + options.path + ";";
    }
    if (options.domain) {
      cookieString += "domain=" + options.domain + ";";
    }
    if (options.secure === false && options.sameSite === "None") {
      options.secure = true;
      console.warn(`[ngx-cookie-service] Cookie ${name} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`);
    }
    if (options.secure) {
      cookieString += "secure;";
    }
    if (!options.sameSite) {
      options.sameSite = "Lax";
    }
    cookieString += "sameSite=" + options.sameSite + ";";
    if (options.partitioned) {
      cookieString += "Partitioned;";
    }
    this.document.cookie = cookieString;
  }
  /**
   * Delete cookie by name
   *
   * @param name   Cookie name
   * @param path   Cookie path
   * @param domain Cookie domain
   * @param secure Cookie secure flag
   * @param sameSite Cookie sameSite flag - https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite
   *
   * @author: Stepan Suvorov
   * @since: 1.0.0
   */
  delete(name, path, domain, secure, sameSite = "Lax") {
    if (!this.documentIsAccessible) {
      return;
    }
    const expiresDate = /* @__PURE__ */ new Date("Thu, 01 Jan 1970 00:00:01 GMT");
    this.set(name, "", {
      expires: expiresDate,
      path,
      domain,
      secure,
      sameSite
    });
  }
  /**
   * Delete all cookies
   *
   * @param path   Cookie path
   * @param domain Cookie domain
   * @param secure Is the Cookie secure
   * @param sameSite Is the cookie same site
   *
   * @author: Stepan Suvorov
   * @since: 1.0.0
   */
  deleteAll(path, domain, secure, sameSite = "Lax") {
    if (!this.documentIsAccessible) {
      return;
    }
    const cookies = this.getAll();
    for (const cookieName in cookies) {
      if (cookies.hasOwnProperty(cookieName)) {
        this.delete(cookieName, path, domain, secure, sameSite);
      }
    }
  }
};
_SsrCookieService.ɵfac = function SsrCookieService_Factory(t) {
  return new (t || _SsrCookieService)(ɵɵinject(DOCUMENT), ɵɵinject(PLATFORM_ID), ɵɵinject(REQUEST, 8));
};
_SsrCookieService.ɵprov = ɵɵdefineInjectable({
  token: _SsrCookieService,
  factory: _SsrCookieService.ɵfac,
  providedIn: "root"
});
var SsrCookieService = _SsrCookieService;
(() => {
  (typeof ngDevMode === "undefined" || ngDevMode) && setClassMetadata(SsrCookieService, [{
    type: Injectable,
    args: [{
      providedIn: "root"
    }]
  }], () => [{
    type: Document,
    decorators: [{
      type: Inject,
      args: [DOCUMENT]
    }]
  }, {
    type: void 0,
    decorators: [{
      type: Inject,
      args: [PLATFORM_ID]
    }]
  }, {
    type: void 0,
    decorators: [{
      type: Optional
    }, {
      type: Inject,
      args: [REQUEST]
    }]
  }], null);
})();
export {
  REQUEST,
  SsrCookieService
};
//# sourceMappingURL=ngx-cookie-service-ssr.js.map
